<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>üåå Î∞§ÌïòÎäò Î≥ÑÌé∏ÏßÄ</title>
<style>
  body {
    margin: 0;
    overflow: hidden;
    height: 100vh;
    background: radial-gradient(circle at 50% 20%, #101935, #060a1f);
    color: #fff;
    font-family: "Noto Sans KR", sans-serif;
  }

  canvas {
    position: fixed;
    inset: 0;
    z-index: 0;
  }

  .ui {
    position: relative;
    z-index: 10;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    height: 100vh;
    text-align: center;
    gap: 12px;
    transition: opacity 0.6s;
  }

  .panel {
    background: rgba(255, 255, 255, 0.08);
    padding: 25px 28px;
    border-radius: 14px;
    backdrop-filter: blur(8px);
    box-shadow: 0 4px 18px rgba(0, 0, 0, 0.4);
    width: min(90%, 400px);
  }

  input, textarea {
    width: 100%;
    margin: 6px 0;
    padding: 10px 12px;
    border-radius: 8px;
    border: none;
    outline: none;
    background: rgba(255, 255, 255, 0.1);
    color: #fff;
    font-size: 15px;
    resize: none;
  }

  button {
    background: linear-gradient(135deg, #ffe1ed, #d7f0ff);
    color: #1a1a1a;
    border: none;
    border-radius: 8px;
    padding: 10px 18px;
    cursor: pointer;
    font-weight: 600;
    margin-top: 8px;
  }

  #stage {
    position: fixed;
    inset: 0;
    z-index: 5;
    display: none;
  }

  .star {
    position: absolute;
    transform: translate(-50%, -50%) scale(1);
    cursor: grab;
    animation: pop 0.6s ease-out;
    user-select: none;
  }

  .star:active {
    cursor: grabbing;
  }

  @keyframes pop {
    0% { transform: translate(-50%, -50%) scale(0.2); opacity: 0; filter: blur(3px);}
    60% { transform: translate(-50%, -50%) scale(1.3); opacity: 1; filter: blur(0);}
    100% { transform: translate(-50%, -50%) scale(1); }
  }

  .message-box {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: rgba(255,255,255,0.1);
    border-radius: 12px;
    padding: 20px 25px;
    backdrop-filter: blur(6px);
    color: #fff;
    text-align: center;
    z-index: 30;
    display: none;
    width: min(80%, 300px);
  }

  .message-box h3 {
    margin: 0 0 8px;
  }

  .close-btn {
    margin-top: 12px;
    background: rgba(255,255,255,0.2);
    border: none;
    color: #fff;
    border-radius: 8px;
    padding: 6px 12px;
    cursor: pointer;
  }

  .add-btn {
    position: fixed;
    bottom: 20px;
    right: 20px;
    background: linear-gradient(135deg, #e7f0ff, #ffe5f7);
    border: none;
    border-radius: 50%;
    width: 55px;
    height: 55px;
    font-size: 26px;
    cursor: pointer;
    z-index: 15;
    box-shadow: 0 0 12px rgba(255,255,255,0.5);
  }
</style>
</head>
<body>
<canvas id="starsCanvas"></canvas>

<!-- ÏûÖÎ†•Ï∞Ω -->
<div class="ui" id="inputUI">
  <div class="panel">
    <h2>üå† Î∞§ÌïòÎäòÏóê Î≥ÑÌé∏ÏßÄ Î≥¥ÎÇ¥Í∏∞</h2>
    <input id="sender" type="text" placeholder="Î≥¥ÎÇ¥Îäî ÏÇ¨Îûå Ïù¥Î¶Ñ">
    <textarea id="message" rows="3" maxlength="60" placeholder="Î≥ÑÏóê Îã¥ÏùÑ ÎÇ¥Ïö©ÏùÑ Ï†ÅÏñ¥Î≥¥ÏÑ∏Ïöî (ÏµúÎåÄ 60Ïûê)"></textarea>
    <button id="sendBtn">Î≥ÑÌé∏ÏßÄ Î≥¥ÎÇ¥Í∏∞</button>
  </div>
</div>

<!-- Î≥ÑÎì§Ïù¥ Î™®Ïó¨ÏûàÎäî Í≥µÍ∞Ñ -->
<div id="stage"></div>

<!-- Î≥Ñ ÌÅ¥Î¶≠ Ïãú Î≥¥Ïù¥Îäî ÌåùÏóÖ -->
<div class="message-box" id="msgBox">
  <h3 id="msgSender"></h3>
  <p id="msgContent"></p>
  <button class="close-btn" id="closeMsg">Îã´Í∏∞</button>
</div>

<!-- Î∞§ÌïòÎäòÏóêÏÑú Ï∂îÍ∞ÄÌïòÍ∏∞ Î≤ÑÌäº -->
<button class="add-btn" id="addStarBtn" style="display:none;">+</button>

<script>
const canvas = document.getElementById("starsCanvas");
const ctx = canvas.getContext("2d");
let w = (canvas.width = innerWidth),
    h = (canvas.height = innerHeight);

window.addEventListener("resize", () => {
  w = canvas.width = innerWidth;
  h = canvas.height = innerHeight;
});

const bgStars = Array.from({ length: 100 }, () => ({
  x: Math.random() * w,
  y: Math.random() * h,
  r: Math.random() * 1.3,
  a: Math.random(),
}));

function drawBackground() {
  ctx.clearRect(0, 0, w, h);
  for (const s of bgStars) {
    ctx.beginPath();
    ctx.fillStyle = `rgba(255,255,255,${0.2 + 0.5 * s.a})`;
    ctx.arc(s.x, s.y, s.r, 0, Math.PI * 2);
    ctx.fill();
    s.a += (Math.random() - 0.5) * 0.03;
  }
  requestAnimationFrame(drawBackground);
}
drawBackground();

const stage = document.getElementById("stage");
const inputUI = document.getElementById("inputUI");
const sendBtn = document.getElementById("sendBtn");
const senderInput = document.getElementById("sender");
const messageInput = document.getElementById("message");
const addStarBtn = document.getElementById("addStarBtn");

let starsData = JSON.parse(localStorage.getItem("starsData") || "[]");

function pastelColor() {
  const hue = Math.floor(Math.random() * 360);
  return `hsl(${hue}, 70%, 80%)`;
}

// ‚≠ê Îë•Í∑º ÎäêÎÇåÏùò Î≥Ñ (ÌÅ∞ ÏÇ¨Ïù¥Ï¶à)
function createStarSVG(color) {
  const ns = "http://www.w3.org/2000/svg";
  const svg = document.createElementNS(ns, "svg");
  svg.setAttribute("width", "110");
  svg.setAttribute("height", "110");
  svg.setAttribute("viewBox", "0 0 100 100");
  const path = document.createElementNS(ns, "path");
  path.setAttribute(
    "d",
    "M50 8 L63 35 Q64 38 68 38 L95 38 Q98 38 96 41 L74 59 Q72 61 73 64 L81 91 Q82 95 78 93 L51 77 Q50 76 49 77 L22 93 Q18 95 19 91 L27 64 Q28 61 26 59 L4 41 Q2 38 5 38 L32 38 Q36 38 37 35 L50 8 Z"
  );
  path.setAttribute("fill", color);
  path.setAttribute("filter", "drop-shadow(0 0 10px " + color + ")");
  svg.appendChild(path);
  return svg;
}

function createStar(x, y, sender, message, color) {
  const container = document.createElement("div");
  container.className = "star";
  container.style.left = x + "px";
  container.style.top = y + "px";
  const svg = createStarSVG(color);
  container.appendChild(svg);
  container.dataset.sender = sender;
  container.dataset.message = message;
  stage.appendChild(container);

  // Î≥Ñ ÌÅ¥Î¶≠ ‚Üí Î©îÏãúÏßÄ Î≥¥Í∏∞
  container.addEventListener("click", (e) => {
    if (!container.isDragging) showMessage(sender, message);
  });

  // Î≥Ñ ÎìúÎûòÍ∑∏ Í∞ÄÎä•
  makeDraggable(container);

  container.animate(
    [
      { transform: "translate(-50%, -50%) scale(0.5)", opacity: 0 },
      { transform: "translate(-50%, -50%) scale(1.3)", opacity: 1 },
      { transform: "translate(-50%, -50%) scale(1)", opacity: 1 }
    ],
    { duration: 1000, easing: "ease-out" }
  );
}

function makeDraggable(el) {
  let offsetX, offsetY;
  let isDragging = false;

  el.addEventListener("mousedown", startDrag);
  el.addEventListener("touchstart", startDrag);

  function startDrag(e) {
    e.preventDefault();
    el.isDragging = true;
    isDragging = true;
    const rect = el.getBoundingClientRect();
    const clientX = e.touches ? e.touches[0].clientX : e.clientX;
    const clientY = e.touches ? e.touches[0].clientY : e.clientY;
    offsetX = clientX - rect.left;
    offsetY = clientY - rect.top;
    window.addEventListener("mousemove", drag);
    window.addEventListener("mouseup", endDrag);
    window.addEventListener("touchmove", drag);
    window.addEventListener("touchend", endDrag);
  }

  function drag(e) {
    if (!isDragging) return;
    const clientX = e.touches ? e.touches[0].clientX : e.clientX;
    const clientY = e.touches ? e.touches[0].clientY : e.clientY;
    el.style.left = clientX - offsetX + "px";
    el.style.top = clientY - offsetY + "px";
  }

  function endDrag() {
    isDragging = false;
    el.isDragging = false;
    window.removeEventListener("mousemove", drag);
    window.removeEventListener("mouseup", endDrag);
    window.removeEventListener("touchmove", drag);
    window.removeEventListener("touchend", endDrag);

    // Ï†ÄÏû•Îêú Î≥Ñ ÏúÑÏπò ÏóÖÎç∞Ïù¥Ìä∏
    const index = Array.from(stage.children).indexOf(el);
    if (index >= 0 && starsData[index]) {
      starsData[index].x = parseFloat(el.style.left);
      starsData[index].y = parseFloat(el.style.top);
      localStorage.setItem("starsData", JSON.stringify(starsData));
    }
  }
}

function showMessage(sender, message) {
  const box = document.getElementById("msgBox");
  document.getElementById("msgSender").textContent = sender ? `üíå ${sender}Ïùò Ìé∏ÏßÄ` : "üí´ ÏùµÎ™ÖÏùò Ìé∏ÏßÄ";
  document.getElementById("msgContent").textContent = message;
  box.style.display = "block";
}

document.getElementById("closeMsg").addEventListener("click", () => {
  document.getElementById("msgBox").style.display = "none";
});

function addStar() {
  const sender = senderInput.value.trim();
  const message = messageInput.value.trim();
  if (!message) return alert("ÎÇ¥Ïö©ÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî!");

  const color = pastelColor();
  const x = Math.random() * w * 0.8 + w * 0.1;
  const y = Math.random() * h * 0.5 + h * 0.1;

  createStar(x, y, sender, message, color);
  starsData.push({ x, y, sender, message, color });
  localStorage.setItem("starsData", JSON.stringify(starsData));
}

sendBtn.addEventListener("click", () => {
  addStar();
  inputUI.style.opacity = "0";
  setTimeout(() => {
    inputUI.style.display = "none";
    stage.style.display = "block";
    addStarBtn.style.display = "block";
  }, 600);
});

addStarBtn.addEventListener("click", () => {
  inputUI.style.display = "flex";
  inputUI.style.opacity = "1";
  stage.style.display = "none";
  addStarBtn.style.display = "none";
  senderInput.value = "";
  messageInput.value = "";
});

window.addEventListener("load", () => {
  inputUI.style.display = "flex";
  stage.style.display = "none";

  // Ï†ÄÏû•Îêú Î≥Ñ ÌëúÏãú
  starsData.forEach(s => createStar(s.x, s.y, s.sender, s.message, s.color));
});
</script>
</body>
</html>