<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ë°¤í•˜ëŠ˜ ë³„í¸ì§€ ğŸŒŒ</title>
  <style>
    body {
      margin: 0;
      overflow: hidden;
      background: radial-gradient(circle at bottom, #0b0b24 0%, #000010 80%);
      font-family: "Pretendard", sans-serif;
      color: white;
      height: 100vh;
    }

    #formContainer {
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(255, 255, 255, 0.15);
      padding: 12px 18px;
      border-radius: 14px;
      backdrop-filter: blur(6px);
      display: flex;
      gap: 10px;
      z-index: 10;
    }

    input, textarea {
      border: none;
      border-radius: 10px;
      padding: 6px 10px;
      outline: none;
    }

    textarea {
      resize: none;
    }

    button {
      border: none;
      background: #ffffffaa;
      color: #333;
      padding: 6px 12px;
      border-radius: 10px;
      cursor: pointer;
      transition: 0.2s;
    }

    button:hover {
      background: #fff;
    }

    .star {
      position: absolute;
      width: 28px;
      height: 28px;
      clip-path: polygon(50% 0%, 61% 35%, 98% 35%, 68% 57%, 79% 91%, 
                         50% 70%, 21% 91%, 32% 57%, 2% 35%, 39% 35%);
      cursor: pointer;
      animation: twinkle 2s infinite ease-in-out;
    }

    @keyframes twinkle {
      0%, 100% { opacity: 1; transform: scale(1); }
      50% { opacity: 0.7; transform: scale(1.2); }
    }

    #popup {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(255, 255, 255, 0.15);
      backdrop-filter: blur(8px);
      border-radius: 18px;
      padding: 20px;
      display: none;
      flex-direction: column;
      align-items: center;
      text-align: center;
      z-index: 20;
      width: 260px;
    }

    #popup button {
      margin-top: 10px;
      background: #fff;
      color: #000;
    }

    #resetButton {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: rgba(255, 80, 80, 0.8);
      color: white;
      border: none;
      border-radius: 12px;
      padding: 8px 14px;
      cursor: pointer;
      z-index: 10;
    }

    #resetButton:hover {
      background: rgba(255, 60, 60, 1);
    }
  </style>
</head>
<body>
  <div id="formContainer">
    <input type="text" id="name" placeholder="ë³´ë‚´ëŠ” ì‚¬ëŒ" />
    <textarea id="message" rows="1" placeholder="ë³„ì— ë‹´ì„ í¸ì§€"></textarea>
    <button id="addStar">ë³„ ë³´ë‚´ê¸°</button>
  </div>

  <button id="resetButton">ğŸŒ  ì´ˆê¸°í™”</button>

  <div id="popup">
    <h3 id="popupName"></h3>
    <p id="popupMessage"></p>
    <button id="closePopup">ë‹«ê¸°</button>
  </div>

  <!-- Firebase -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-app.js";
    import { getDatabase, ref, push, onValue, remove } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDmuDfVo_NKLLbidliNZ_OW8g-y7qjDq38",
      authDomain: "star-letter-db6ac.firebaseapp.com",
      databaseURL: "https://star-letter-db6ac-default-rtdb.firebaseio.com",
      projectId: "star-letter-db6ac",
      storageBucket: "star-letter-db6ac.firebasestorage.app",
      messagingSenderId: "559166601401",
      appId: "1:559166601401:web:828dba528675aee1a50368"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const starsRef = ref(db, "stars");

    const addStarBtn = document.getElementById("addStar");
    const resetBtn = document.getElementById("resetButton");
    const popup = document.getElementById("popup");
    const popupName = document.getElementById("popupName");
    const popupMessage = document.getElementById("popupMessage");
    const closePopup = document.getElementById("closePopup");

    const colors = ["#AEE6FF", "#E2D2FF", "#FFF4A3", "#FFC4E1"];

    addStarBtn.addEventListener("click", () => {
      const name = document.getElementById("name").value.trim();
      const message = document.getElementById("message").value.trim();
      if (!name || !message) return alert("ì´ë¦„ê³¼ ë‚´ìš©ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”!");

      const x = Math.random() * (window.innerWidth - 40);
      const y = Math.random() * (window.innerHeight - 40);
      const color = colors[Math.floor(Math.random() * colors.length)];

      push(starsRef, { name, message, x, y, color });
      document.getElementById("message").value = "";
    });

    onValue(starsRef, (snapshot) => {
      document.querySelectorAll(".star").forEach(s => s.remove());
      snapshot.forEach(child => {
        const { name, message, x, y, color } = child.val();
        const star = document.createElement("div");
        star.className = "star";
        star.style.left = `${x}px`;
        star.style.top = `${y}px`;
        star.style.background = color;

        // ë“œë˜ê·¸ ê¸°ëŠ¥
        let isDragging = false, offsetX, offsetY;
        star.addEventListener("mousedown", e => {
          isDragging = true;
          offsetX = e.offsetX;
          offsetY = e.offsetY;
        });
        window.addEventListener("mousemove", e => {
          if (isDragging) {
            star.style.left = `${e.pageX - offsetX}px`;
            star.style.top = `${e.pageY - offsetY}px`;
          }
        });
        window.addEventListener("mouseup", () => isDragging = false);

        // í´ë¦­ ì‹œ íŒì—…
        star.addEventListener("click", () => {
          popupName.textContent = name + "ì˜ ë³„";
          popupMessage.textContent = message;
          popup.style.display = "flex";
        });

        document.body.appendChild(star);
      });
    });

    closePopup.addEventListener("click", () => {
      popup.style.display = "none";
    });

    resetBtn.addEventListener("click", () => {
      if (confirm("ì •ë§ ëª¨ë“  ë³„ì„ ì‚­ì œí•˜ì‹œê² ì–´ìš”? ğŸŒŒ")) {
        remove(starsRef);
      }
    });
  </script>
</body>
</html>
