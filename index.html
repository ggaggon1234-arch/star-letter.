<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ë°¤í•˜ëŠ˜ ë³„í¸ì§€ âœ¨</title>
  <style>
    body {
      margin: 0;
      overflow: hidden;
      background: radial-gradient(ellipse at bottom, #0d1b2a 0%, #000 100%);
      height: 100vh;
      color: white;
      font-family: "Pretendard", sans-serif;
    }

    canvas {
      position: absolute;
      top: 0;
      left: 0;
    }

    #inputBox {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(255, 255, 255, 0.9);
      padding: 20px 25px;
      border-radius: 20px;
      text-align: center;
      color: black;
      box-shadow: 0 0 20px rgba(255, 255, 255, 0.2);
    }

    input, textarea, button {
      margin: 10px 0;
      padding: 10px;
      border-radius: 10px;
      border: none;
      width: 100%;
    }

    button {
      background: #a5c9ca;
      cursor: pointer;
      transition: 0.2s;
    }

    button:hover {
      background: #87b5b5;
    }

    .star {
      position: absolute;
      transform: translate(-50%, -50%);
      cursor: pointer;
      animation: twinkle 2s infinite ease-in-out;
    }

    @keyframes twinkle {
      0%, 100% { opacity: 0.8; transform: scale(1); }
      50% { opacity: 1; transform: scale(1.1); }
    }
  </style>
</head>
<body>
  <div id="inputBox">
    <h2>ğŸŒŸ ë°¤í•˜ëŠ˜ì— ë³„í¸ì§€ ë³´ë‚´ê¸°</h2>
    <input type="text" id="sender" placeholder="ë³´ë‚´ëŠ” ì‚¬ëŒ ì´ë¦„" />
    <textarea id="message" placeholder="í¸ì§€ ë‚´ìš©ì„ ì ì–´ì£¼ì„¸ìš”"></textarea>
    <button id="send">ë³„ ë„ìš°ê¸° âœ¨</button>
  </div>

  <canvas id="sky"></canvas>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-app.js";
    import { getDatabase, ref, push, onValue } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDmuDfVo_NKLLbidliNZ_OW8g-y7qjDq38",
      authDomain: "star-letter-db6ac.firebaseapp.com",
      databaseURL: "https://star-letter-db6ac-default-rtdb.firebaseio.com",
      projectId: "star-letter-db6ac",
      storageBucket: "star-letter-db6ac.firebasestorage.app",
      messagingSenderId: "559166601401",
      appId: "1:559166601401:web:828dba528675aee1a50368"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const sky = document.getElementById("sky");
    const ctx = sky.getContext("2d");

    sky.width = window.innerWidth;
    sky.height = window.innerHeight;

    function randomColor() {
      const colors = ["#FFD6E0", "#F6E6B4", "#D9F8C4", "#AEE1F9", "#E1C6F5"];
      return colors[Math.floor(Math.random() * colors.length)];
    }

    // ë³„ ì¶”ê°€
    document.getElementById("send").addEventListener("click", () => {
      const sender = document.getElementById("sender").value.trim();
      const message = document.getElementById("message").value.trim();

      if (!sender || !message) return alert("ì´ë¦„ê³¼ ë‚´ìš©ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš” ğŸ’Œ");

      const x = Math.random() * sky.width;
      const y = Math.random() * sky.height;
      const color = randomColor();

      push(ref(db, "stars"), { sender, message, x, y, color });

      document.getElementById("sender").value = "";
      document.getElementById("message").value = "";
    });

    // ë³„ ë¶ˆëŸ¬ì˜¤ê¸° (ì‹¤ì‹œê°„ ë°˜ì˜)
    onValue(ref(db, "stars"), (snapshot) => {
      const stars = snapshot.val();
      ctx.clearRect(0, 0, sky.width, sky.height);
      if (!stars) return;

      Object.values(stars).forEach(star => {
        ctx.fillStyle = star.color;
        drawStar(star.x, star.y, 5, 10, 5);
      });
    });

    function drawStar(cx, cy, spikes, outerRadius, innerRadius) {
      let rot = Math.PI / 2 * 3;
      let x = cx;
      let y = cy;
      const step = Math.PI / spikes;

      ctx.beginPath();
      ctx.moveTo(cx, cy - outerRadius);
      for (let i = 0; i < spikes; i++) {
        x = cx + Math.cos(rot) * outerRadius;
        y = cy + Math.sin(rot) * outerRadius;
        ctx.lineTo(x, y);
        rot += step;

        x = cx + Math.cos(rot) * innerRadius;
        y = cy + Math.sin(rot) * innerRadius;
        ctx.lineTo(x, y);
        rot += step;
      }
      ctx.lineTo(cx, cy - outerRadius);
      ctx.closePath();
      ctx.fill();
    }

    // ë³„ í´ë¦­ ì´ë²¤íŠ¸
    sky.addEventListener("click", (e) => {
      const x = e.clientX;
      const y = e.clientY;
      onValue(ref(db, "stars"), (snapshot) => {
        const stars = snapshot.val();
        if (!stars) return;
        Object.values(stars).forEach(star => {
          const dx = x - star.x;
          const dy = y - star.y;
          if (Math.sqrt(dx * dx + dy * dy) < 15) {
            alert(`ğŸ’Œ From ${star.sender}\n\n${star.message}`);
          }
        });
      }, { onlyOnce: true });
    });

  </script>
</body>
</html>
